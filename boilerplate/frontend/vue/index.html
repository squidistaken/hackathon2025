<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Gomibo Hackathon – Vue Debug UI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body>
<div id="app">

  <h1>Gomibo Hackathon – Backend Tester</h1>

  <p>This page simply calls your backend API and shows the JSON response.</p>

  <div>
    <button @click="loadProducts" :disabled="loading">Load products (GET /products)</button>
    <button @click="addToCart" :disabled="loading">Add product #1 to cart (POST /cart/add)</button>
    <button @click="loadCart" :disabled="loading">View cart (GET /cart)</button>
  </div>

  <div v-if="error">
    <strong>Error:</strong> {{ error }}
  </div>

  <h2>Last response:</h2>
  <pre>{{ lastResponse }}</pre>

</div>

<script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
<script>
  const { createApp, reactive } = Vue;

  const API_BASE = '';

  async function apiGet(path) {
    const res = await fetch(API_BASE + path);
    if (!res.ok) throw new Error('GET ' + path + ' failed: ' + res.status);
    return res.json();
  }

  async function apiPost(path, body) {
    const res = await fetch(API_BASE + path, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(body),
    });
    if (!res.ok) {
      const text = await res.text();
      throw new Error('POST ' + path + ' failed: ' + res.status + ' ' + text);
    }
    return res.json();
  }

  createApp({
    setup() {
      const state = reactive({
        lastResponse: '{}',
        error: '',
        loading: false,
      });

      async function safeCall(fn) {
        state.error = '';
        state.loading = true;
        try {
          const data = await fn();
          state.lastResponse = JSON.stringify(data, null, 2);
        } catch (e) {
          state.error = e.message;
        } finally {
          state.loading = false;
        }
      }

      function loadProducts() {
        return safeCall(() => apiGet('/products'));
      }

      function addToCart() {
        const payload = { product_id: 1, quantity: 1 };
        return safeCall(() => apiPost('/cart/add', payload));
      }

      function loadCart() {
        return safeCall(() => apiGet('/cart'));
      }

      return {
        ...state,
        loadProducts,
        addToCart,
        loadCart
      };
    }
  }).mount('#app');
</script>
</body>
</html>
